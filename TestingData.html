<!DOCTYPE html>
<html>
<head>
    <title>Excel Data Loader</title>
    <style>
        table {
            border-collapse: collapse;
        }
        td, th {
            padding: 6px 10px;
            border: 1px solid #444;
        }
    </style>
</head>
<body>

<h2>Google Sheet Data</h2>
<button onclick="loadData()">üîÑ Refresh Data</button>

<table id="dataTable"></table>

<script>
const sheetURL =
    "https://docs.google.com/spreadsheets/d/1s1XHXFJe0_o2fp7ysxb0AFcoqmkna2C8rO_kcuyeolQ/gviz/tq?tqx=out:csv";

async function loadData() {
    console.clear();
    console.log("üîÑ Loading Google Sheet data...");
    console.log("üìÑ Sheet URL:", sheetURL);

    try {
        const response = await fetch(sheetURL);

        console.log("üì° Fetch response:", response);

        if (!response.ok) {
            throw new Error(`HTTP Error: ${response.status}`);
        }

        const text = await response.text();
        console.log("üìú Raw CSV data:\n", text);

        const rows = parseCSV(text);
        console.log("üìä Parsed rows:", rows);

        const table = document.getElementById("dataTable");
        table.innerHTML = "";

        rows.forEach((row, rowIndex) => {
            const tr = document.createElement("tr");

            row.forEach(cell => {
                const td = document.createElement(rowIndex === 0 ? "th" : "td");
                td.textContent = cell;
                tr.appendChild(td);
            });

            table.appendChild(tr);
        });

        console.log("‚úÖ Table rendered successfully");

    } catch (error) {
        console.error("‚ùå Failed to load sheet:", error);
        alert("Error loading data. Check console logs.");
    }
}

/* Proper CSV parser (handles quoted commas) */
function parseCSV(csvText) {
    const rows = [];
    let currentRow = [];
    let currentCell = "";
    let insideQuotes = false;

    for (let i = 0; i < csvText.length; i++) {
        const char = csvText[i];

        if (char === '"' && csvText[i + 1] === '"') {
            currentCell += '"';
            i++;
        } else if (char === '"') {
            insideQuotes = !insideQuotes;
        } else if (char === "," && !insideQuotes) {
            currentRow.push(currentCell.trim());
            currentCell = "";
        } else if (char === "\n" && !insideQuotes) {
            currentRow.push(currentCell.trim());
            rows.push(currentRow);
            currentRow = [];
            currentCell = "";
        } else {
            currentCell += char;
        }
    }

    if (currentCell) {
        currentRow.push(currentCell.trim());
        rows.push(currentRow);
    }

    return rows;
}

// Auto-load on page open
window.onload = loadData;
</script>

</body>
</html>
